% Chapter 7

\chapter{Conclusion}% Main chapter title

\label{Chapter7} % For referencing the chapter elsewhere, use \ref{Chapter7} 
In this chapter, the main goals of the thesis with respect to the problem statement stated in Chapter 1 and the ways the thesis is done are summarized in Subsection 7.1. Subsection 7.2 presents the works that are related to this thesis. In addition, how the thesis contributes to overcome the research problems is also presented in this subsection. Problems that have not been solved in the thesis are presented in Subsection 7.3, then some suggestions for further research are discussed in the last subsection.
%----------------------------------------------------------------------------------------

\section{General summarization}
The main goals of this thesis are to design a relational database model, and to develop a database application to store OSA data and open for other bio-physiological data. To pursue the goals, the research problems are stated, then the pros and cons of the related works on the problems are presented. The strengths of the related works are further considered, while the limitations are improved or replaced in this thesis.\\
At first, a literature overview of Sleep Apnea and its’ characteristics are presented. It is because the designed database model and database application are mainly used for storing and analyzing signals from this illness. Since the strengths of the related works are used in the thesis, their characteristics, i.e., collected sources, platform used, formats for transferring and storing data, supported functions and documents, etc. are studied carefully. In addition, the requirements for both the database model and database application are analyzed. For database modeling, entities are derived from the observable signals and characteristics of OSA, and relationships between the entities are defined. The database modeling process is performed, which results the logical database model used in the thesis. For database application, two wrappers are provided for importing data from real time sources and non-real time sources. The goals are evaluated by performing many experiments to prove that the thesis has solved the research problems which are stated in Section Problem statement in Chapter 1. The main focuses of the experiments are the feasibility of the database design and the performance of the database application on a mobile device powered by Android. That is, the database application can perform multitasking, and can collect data from the CESAR acquisition tool for long time used without losing data. At first, each function of the database application is evaluated separately, then stress tests are performed where the functions are simultaneously evaluated with high workloads.

\section{Related works}
There are many efforts to collect and store Sleep Apnea signals data in an efficient way with not only regarding to different criteria, but also respecting to the used hardwares. Since each clinic has its owns criteria on its chosen hardware platform, the clinic defines its own mothed to collect and manage the collected data. However, some clinics chooses to use a standard format such as EDF/EDF plus file to store the data. Some of related works on collecting and storing Sleep Apnea signals data are chosen to present in this subsection, which are "An Automated Obstructive Sleep Apnoea Screening Application for Smartphones" \citep{IEEESLEEPAP}, "The DREAMS Apnea Database" \citep{tcts}, "MIT-BIH Polysomnographic Database" \citep{MIT_BIH}, nox medical \citep{noxmedical}, and the CESAR acquisition tool \citep{SP} .\\
The CESAR acquisition tool collects bio-signal data for Obstructive Sleep Apnea by using BITalino sensors. The data are either stored on a mobile device as a text file, or sent to an application by using TCP/IP protocol. The text file contains redundant information which describes metadata for each sample, that leads to increasing storage space requirements. However, the tool is carefully evaluated with respect to resource usages, i.e., power consumption, CPU usage, etc., and perfectly transmits samples without losing data. Moreover, the data format for sending packets is clearly defined, which allows other applications to easily receive and use. As a result, the tool is considered a good collector candidate to collect samples from real time sensors, but not for storing and analyzing data.\\
Nox medical also provides an acquisition tool for Android devices to collect data on their professional sensor kits (currently only for Nox A1). The tool can be downloaded on the Play Store by searching “Noxturnal” keyword. The tool is user friendly, and provides many useful functions such as view sensor status, do impedance checks, perform bio calibration, view live signals, configure recordings before starting a recording. Since it is an application for a commercial product, specifications for packets sent from their sensor kits are not provided, in addition, it does not provide an option to keep the collected data on the mobile device as the CESAR acquisition tool does.\\
In contrast to the Noxtural and CESAR acquisition tool, the automated obstructive sleep apnea screening application for smart phones collects data from real time sensor sources, but does not save the collected data. Instead, data from sensors are extracted before sending to a data fusion and classification in order to determine whether the patient requires treatment for sleep apnea illness. Therefore, specifications for storing data are not provided in the research paper from this tool.\\
Conversely, MIT-BIH do not clearly present how either they collect polysomnogram data, or specifications of the data files, but they provide software packages to interact with their data files. They also allow to convert their data files to standard file formats such as EDF/EDF plus formats. It is inconvenient in case users need some part of information, but they have to install software package, convert data files, etc.\\
To store raw data on a mobile device is challenging, it is because the size of the data file grows quite fast that can lead to overflow the storage capacity of the mobile device. The way the CESAR acquisition tool keeps the raw data in a mobile device is inefficient because of the overhead of the metadata for each sample. This overhead can be removed to save storage space by using the EDF/EDF plus file format \citep{EDF1}. All metadata for samples are defined only once in the header of a EDF/EDF plus file, then following by only sample values for all used channels. Hence, the storage space requirements are minimized. This format is a good choice when the storage capability of a mobile device is limited, in addition, the bandwidth for sending the collected data is low. The EDF/EDF file formats are currently used as a standard interface for storing and sharing polysomnogram data between different data sources.\\
However, the files formats from the CESAR acquisition tool and EDF/EDF plus are at a low abstraction level with indexing primitive, which is difficult for a user to take some part of a recording in the files regarding to some conditions. A long and complex codes need to be written for each action on the data files, and interfaces of an application that uses the files need to be changed and recompiled if a new action on the data files is defined.\\
Therefore, to integrate the advantages and reduce the limitation of the related works is imperative. In other words, to have a solution in which data from sensor kits can be collected and saved on a mobile device with minimizing resource usages and maximizing data usage, i.e., easy to extract, analyze, backup, restore, share, etc., with low power consumption, storage space and memory used, CPU used, etc. is necessary.
\section{Contributions}
This thesis proposes an open database model and a database application for storing Obstructive Sleep Apnea monitoring data and other bio-physiology signals on an Android device. The database application allows to store monitoring data from the BITalino sensor kits, and to import existing polysomnogram data from EDF/EDF plus files. To avoid reinventing the wheel, the thesis makes use of the advantages from the CESAR acquisition tool, which has high performance, low resource usages, and stable when collecting data for long time. The CESAR acquisition tool provides an interface for its packets that are sent via TCP/IP; the database application therefore provides a friendly user interface to manage the connection from the tool. The application allows multiple sensor sources to connect and store their data to the database on the device simultaneously. A list of current sources is presented on a friendly graphical view, in which the status of each source is illustrated whether the source is active, saving its data to database, or shows its data on a graphical graph. Each sensor source is managed by a separate thread, which allows maximizing performance when collecting data in real time.\\
For backing up and restoring data, the database application provides two functions which are EDF/EDF plus importer and EDF/EDF plus exporter. It is because the storage space requirements are minimized when using these formats. Moreover, when sending or sharing data, the bandwidth used is low compared to other file formats. A user can import a EDF file by choosing the file from mass storage such as SD card via a graphical file chooser. A process bar indicates how many percent a file has been imported, and a user can query, share, analyze, etc., on the imported part of the file. It is not logic for other data types, but it might be a good option for the bio-physiological data, because the file is treated as a stream of data. If a user needs only some parts of the file, the user does not need to wait for the whole file loaded.\\
By providing a relational database solution for storing polysomnogram data, the thesis can make use of SQL language and SQL function to analyze data directly on a mobile device. Moreover, the database application also allows users to easily choose parts of recordings, combine data from multiple channels to do comparison such as the quality of collected data, or to export to a EDF file for sharing purpose. Combining data from multiple channels also allows a patient to use different sensor data kits to collect data into one record.\\
Nonetheless, the database model and database application are designed in the way that provides maximum reliability and user friendliness. That is, the application takes the user experiment into considering, it is to say, users prefer to interact with symbols and icons compared to text. The users do not need to have a user manual to use the application. However, to provide the users a comprehensive information how to use the application, a user manual is provided in Appendix \ref{AppendixA}. The reliability is proven via stress test in the last subsection of the evaluation chapter. That is, the application can manage up to XX channels while importing and exporting data without crashing, or losing data.\\
Therefore, the database model and database application that are provided in the thesis are considered efficient for storing, managing, and analyzing Obstructive Sleep Apnea signals, and other bio-physiological signals.
\section{Open problems}
\textbf{Considerations concerning the chosen platform}\\
The database application is required running without interrupting. That is, it must not be suspended, or not be killed by the operative system. It is because the database application collects data from sensor sources in real time. However, the API guides from the Android developers \citep{AndroidAPIProcess} illustrates that Android might decide to kill a process at some point. The main goal of this action is to try to keep a certain amount of memory (RAM) for smooth experience, and to save battery as there are less applications using the phone's CPU. Once the application is killed, all components running in it are consequently destroyed. Victims that seem to be killed by Android are usually applications hosting activities that are not visible on screen. Currently, the CESAR acquisition tool is killed if the screen of a mobile device is off for a period of time, that causes the database application cannot receive data from the tool. The screen need to be on during a collecting process; it is inefficient. By studying the life cycle of the processes and application in Android, the database application currently does not have this problem because it is a foreground process. As presented in the API guides for the life cycle of processes and application \citep{AndroidAPIProcessLifeCycle}, Android puts each process into an "importance hierarchy" based on the components of the process and the state of these components; the first priority in the list are foreground processes which are only killed as a last resort when memory is too low. Therefore, nothing can guarantee that an application is never killed by the system.\\\\
SQLite database management system, which is used for implementing the designed database model, is integrated in the Android platform, and does not allow multiple threads read the database in parallel. As presented in SQLiteOpenHelper API\citep{AndroidAPISQLiteOpen}, the same object, which is a write database object, is returned regardless the get readable or get writable functions are called. Hence, using multiple reading threads to increase the database performance is not possible on the Android platform. Moreover, the SQLite uses dynamic types for storing data. That is, the data types need to be converted when saving and retrieving, and it is therefore causing poor performance.\\\\
\textbf{Considerations concerning the design and implementation}\\
The designs for the database model and database application are divided into two parts, the first part is a high level and platform independent, while the second part is a specific implementation, and is considered a proof of concept for the high level design. Therefore, the application might contains many bugs, and not handle all small problems which can cause the application crashed. The implementation is mainly focusing on proving the feasibility of the database model and database application designs, and is far away to be a commercial application.
\section{Future works}
This thesis provides a relational database model and a database application for storing Obstructive Sleep Apnea signals, and opens for storing other bio-physiological signals on a mobile device. In addition, the designs are platform independent, and they can therefore be implemented on either Android, iOS, Windows Phone, etc.\\\\
A suggestion for further research is to implement the relational database design on different mobile operations, then make a comparison between the implementations with respect to the experiments that presented in the evaluation chapter. In addition, the database application provides a raw query interface that allow researchers to execute their SQL query statements. The researchers can also write their own mining modules as independent Android activities, then attach the modules to the last fragment in the database application. Hence, an other suggestion is to develop and evaluate different mining methods on the designed data for detecting if a patient has Obstructive Sleep Apnea problem. Nonetheless, a quality comparing between sensors can be performed by using multiple sensor sources to collect data simultaneously.\\\\
Beside the presented suggestions above, there are also some issues that need to be further investigated based on the current implementation of the database application. The first issue is the need to backup collected data to a external storage place such as a cloud server when the free space on the mobile device is at a specific threshold. Hence, it is necessary to have a thread which takes a responsible for backing up the collected data by exporting the old data to EDF files and send to a storage place. This thread does not need to keep running all the time, it is created when the size of the database reaches the threshold. The second issue is the need for remotely querying. That is, physicians are allowed remotely querying data on the mobile device of a patient, or can get some part of data by sending a request to the database application which is installed on patient's mobile device.\\
